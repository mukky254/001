<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate QR Code - IN Attendance System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- Add this to your head section -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* QR Code Display Styles */
        .qr-image-container {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #dee2e6;
        }
        
        .qr-code-image {
            max-width: 100%;
            height: auto;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 1px solid #ced4da;
            padding: 10px;
            background: white;
        }
        
        .qr-code-image:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .qr-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .qr-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .detail-item {
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .detail-item strong {
            color: #495057;
            margin-right: 8px;
            display: inline-block;
            width: 120px;
        }
        
        .detail-item i {
            width: 20px;
            margin-right: 8px;
            color: #6c757d;
        }
        
        .qr-instructions {
            font-size: 14px;
        }
        
        .qr-instructions ol {
            margin-left: 20px;
            margin-bottom: 0;
        }
        
        .qr-instructions li {
            margin-bottom: 5px;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-badge.active {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-badge.expired {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Fullscreen QR */
        .qr-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .qr-fullscreen img {
            max-width: 90%;
            max-height: 80%;
            border: 3px solid white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .qr-fullscreen .close-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            background: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .qr-fullscreen .close-btn:hover {
            background: #ff6b6b;
            color: white;
            transform: scale(1.1);
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 9999;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 400px;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
            border-left: 4px solid #1e7e34;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            border-left: 4px solid #bd2130;
        }
        
        .notification.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            border-left: 4px solid #117a8b;
        }
        
        .notification.fade-out {
            animation: fadeOut 0.3s ease forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-control {
            display: block;
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.5rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .form-control:focus {
            color: #495057;
            background-color: #fff;
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
        }
        
        label {
            display: inline-block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .form-text {
            display: block;
            margin-top: 0.25rem;
            font-size: 0.875em;
            color: #6c757d;
        }
        
        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            line-height: 1.5;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #117a8b);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #dee2e6;
            color: #495057;
        }
        
        .btn-outline:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        /* Card Styles */
        .card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card-header {
            padding: 1.25rem 1.5rem;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 10px 10px 0 0;
        }
        
        .card-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .card-actions {
            float: right;
        }
        
        /* Table Styles */
        .table-responsive {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            margin-bottom: 1rem;
            color: #212529;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }
        
        .table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
            background-color: #f8f9fa;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-muted { color: #6c757d; }
        .mb-0 { margin-bottom: 0; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 1rem; }
        .mt-4 { margin-top: 1.5rem; }
        .mt-5 { margin-top: 3rem; }
        .pt-3 { padding-top: 1rem; }
        .border-top { border-top: 1px solid #dee2e6; }
        .bg-light { background-color: #f8f9fa; }
        .rounded { border-radius: 0.5rem; }
        .float-right { float: right; }
        .row {
            display: flex;
            flex-wrap: wrap;
            margin-right: -15px;
            margin-left: -15px;
        }
        .col-lg-6, .col-md-6 {
            position: relative;
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
        }
        @media (min-width: 768px) {
            .col-md-6 { flex: 0 0 50%; max-width: 50%; }
        }
        @media (min-width: 992px) {
            .col-lg-6 { flex: 0 0 50%; max-width: 50%; }
        }
        
        /* Container */
        .container-fluid {
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
            align-items: center;
            justify-content: center;
        }
        
        .modal-dialog {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow: auto;
        }
        
        .modal-content {
            padding: 20px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>IN Attendance</span>
            </div>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="sidebar-user">
            <div class="user-avatar" id="userAvatar">JD</div>
            <div class="user-info">
                <h4 id="userName">John Doe</h4>
                <span class="user-role" id="userRole">Lecturer</span>
            </div>
        </div>

        <nav class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-title">MAIN</div>
                <a href="dashboard.html" class="menu-item">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="profile.html" class="menu-item">
                    <i class="fas fa-user"></i>
                    <span>My Profile</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-title">LECTURER</div>
                <a href="qr-generator.html" class="menu-item active">
                    <i class="fas fa-qr-code"></i>
                    <span>Generate QR Code</span>
                </a>
                <a href="#" class="menu-item" id="myQRCodes">
                    <i class="fas fa-list"></i>
                    <span>My QR Codes</span>
                </a>
                <a href="#" class="menu-item" id="attendanceReports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Attendance Reports</span>
                </a>
                <a href="#" class="menu-item" id="myClasses">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>My Classes</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-title">ACCOUNT</div>
                <a href="#" class="menu-item">
                    <i class="fas fa-key"></i>
                    <span>Change Password</span>
                </a>
                <a href="#" class="menu-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="page-title">
                    <h1>Generate QR Code</h1>
                    <small>Create QR codes for attendance</small>
                </div>
            </div>
            <div class="header-right">
                <div class="user-dropdown" id="userDropdown">
                    <div class="dropdown-toggle">
                        <div class="user-mini">
                            <div class="mini-avatar" id="miniAvatar">JD</div>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <div class="content-area" id="contentArea">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-6">
                        <!-- QR Generation Form -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Generate New QR Code</h3>
                            </div>
                            <div class="card-body">
                                <form id="qrGenerationForm">
                                    <div class="form-group">
                                        <label for="unitName">Unit Name</label>
                                        <input type="text" id="unitName" class="form-control" 
                                               placeholder="e.g., Database Systems" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="unitCode">Unit Code</label>
                                        <input type="text" id="unitCode" class="form-control" 
                                               placeholder="e.g., CS301" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="duration">Duration (minutes)</label>
                                        <input type="number" id="duration" class="form-control" 
                                               placeholder="e.g., 60" min="1" max="240" required>
                                        <small class="form-text text-muted">
                                            QR code will expire after this duration
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label for="classType">Class Type</label>
                                        <select id="classType" class="form-control">
                                            <option value="lecture">Lecture</option>
                                            <option value="tutorial">Tutorial</option>
                                            <option value="lab">Lab</option>
                                            <option value="seminar">Seminar</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="topic">Topic (Optional)</label>
                                        <input type="text" id="topic" class="form-control" 
                                               placeholder="e.g., Introduction to SQL">
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-block" id="generateBtn">
                                        <i class="fas fa-qrcode"></i> Generate QR Code
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <!-- QR Code Display -->
                        <div class="card" id="qrDisplay" style="display: none;">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-qrcode"></i> Generated QR Code
                                    <button class="btn btn-sm btn-outline float-right" onclick="showFullscreenQR()">
                                        <i class="fas fa-expand"></i> Fullscreen
                                    </button>
                                </h3>
                            </div>
                            <div class="card-body">
                                <!-- QR Code Image will be displayed here -->
                                <div id="qrImageDisplay"></div>
                                
                                <!-- QR Code Canvas (hidden) -->
                                <div id="qrcode" style="display: none;"></div>
                                
                                <!-- QR Details -->
                                <div class="qr-details mt-4">
                                    <h5 class="mb-3">QR Code Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="detail-item">
                                                <strong><i class="fas fa-book"></i> Unit:</strong>
                                                <span id="qrUnitName">-</span> (<span id="qrUnitCode">-</span>)
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-chalkboard-teacher"></i> Class Type:</strong>
                                                <span id="qrClassType">-</span>
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-user-tie"></i> Lecturer:</strong>
                                                <span id="qrLecturer">-</span>
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-clock"></i> Generated:</strong>
                                                <span id="qrGenerated">-</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="detail-item">
                                                <strong><i class="fas fa-hourglass-end"></i> Expires:</strong>
                                                <span id="qrExpires">-</span>
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-stopwatch"></i> Duration:</strong>
                                                <span id="qrDuration">-</span> minutes
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-tag"></i> Topic:</strong>
                                                <span id="qrTopic">-</span>
                                            </div>
                                            <div class="detail-item">
                                                <strong><i class="fas fa-fingerprint"></i> QR Code ID:</strong>
                                                <code id="qrCodeId">-</code>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="qr-actions mt-4 pt-3 border-top">
                                    <div class="row">
                                        <div class="col-md-4 mb-2">
                                            <button class="btn btn-success btn-block" id="printQRBtn">
                                                <i class="fas fa-print"></i> Print QR Code
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-2">
                                            <button class="btn btn-info btn-block" id="downloadQRBtn">
                                                <i class="fas fa-download"></i> Download QR
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-2">
                                            <button class="btn btn-primary btn-block" onclick="displayQRForClassroom()">
                                                <i class="fas fa-display"></i> Display for Class
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-md-6 mb-2">
                                            <button class="btn btn-outline btn-block" onclick="copyQRData()">
                                                <i class="fas fa-copy"></i> Copy QR Data
                                            </button>
                                        </div>
                                        <div class="col-md-6 mb-2">
                                            <button class="btn btn-outline btn-block" onclick="shareQRCode()">
                                                <i class="fas fa-share-alt"></i> Share QR Code
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Instructions -->
                                <div class="qr-instructions mt-4 p-3 bg-light rounded">
                                    <h6><i class="fas fa-info-circle"></i> How to use this QR Code:</h6>
                                    <ol class="mb-0">
                                        <li>Display the QR code on the projector/screen</li>
                                        <li>Students scan using the IN Attendance app</li>
                                        <li>Attendance is automatically recorded</li>
                                        <li>QR code expires after the set duration</li>
                                        <li>Download/Print for backup or offline use</li>
                                    </ol>
                                </div>
                            </div>
                        </div>

                        <!-- Recent QR Codes -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-history"></i> Recent QR Codes
                                    <div class="card-actions">
                                        <button class="btn btn-sm btn-outline" id="refreshListBtn">
                                            <i class="fas fa-sync"></i> Refresh
                                        </button>
                                    </div>
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Unit</th>
                                                <th>Code</th>
                                                <th>Created</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentQRCodesBody">
                                            <!-- QR codes will be loaded here -->
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">
                                                    No QR codes generated yet
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/qr-generator.js"></script>
    <script src="scripts/auth.js"></script>
    <script>
        // Global functions for QR display
        window.showFullscreenQR = function() {
            const qrImage = document.getElementById('generatedQRImage');
            if (qrImage) {
                const fullscreenDiv = document.createElement('div');
                fullscreenDiv.className = 'qr-fullscreen';
                fullscreenDiv.innerHTML = `
                    <button class="close-btn" onclick="this.parentElement.remove()">Ã—</button>
                    <img src="${qrImage.src}" alt="QR Code">
                    <div class="mt-3 text-white text-center" style="padding: 20px; max-width: 600px;">
                        <h3>${document.getElementById('qrUnitName').textContent}</h3>
                        <p>${document.getElementById('qrUnitCode').textContent} â€¢ ${document.getElementById('qrClassType').textContent}</p>
                        <p>Valid until: ${document.getElementById('qrExpires').textContent}</p>
                        <small>Press ESC or click X to close</small>
                    </div>
                `;
                document.body.appendChild(fullscreenDiv);
                
                // Close on ESC key
                document.addEventListener('keydown', function closeOnEsc(e) {
                    if (e.key === 'Escape') {
                        fullscreenDiv.remove();
                        document.removeEventListener('keydown', closeOnEsc);
                    }
                });
            }
        };

        window.displayQRForClassroom = function() {
            const qrData = {
                qrCodeId: document.getElementById('qrCodeId').textContent,
                unitName: document.getElementById('qrUnitName').textContent,
                unitCode: document.getElementById('qrUnitCode').textContent,
                classType: document.getElementById('qrClassType').textContent,
                topic: document.getElementById('qrTopic').textContent,
                lecturerName: document.getElementById('qrLecturer').textContent,
                duration: parseInt(document.getElementById('qrDuration').textContent),
                expiresAt: document.getElementById('qrExpires').textContent,
                isActive: true
            };
            
            // Open display window
            const displayWindow = window.open('', 'QRDisplay', 'width=800,height=600,menubar=no,toolbar=no,location=no');
            
            const displayHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>QR Code Display - ${qrData.unitName}</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            font-family: Arial, sans-serif;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            min-height: 100vh;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                        }
                        .qr-display-container {
                            text-align: center;
                            background: rgba(255,255,255,0.1);
                            backdrop-filter: blur(10px);
                            padding: 40px;
                            border-radius: 20px;
                            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                            max-width: 800px;
                            width: 90%;
                        }
                        .class-info {
                            margin-bottom: 30px;
                        }
                        .class-info h1 {
                            margin: 0;
                            font-size: 2.5rem;
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                        }
                        .class-info h2 {
                            margin: 10px 0;
                            font-size: 1.8rem;
                            opacity: 0.9;
                        }
                        .qr-code-container {
                            margin: 30px 0;
                            padding: 20px;
                            background: white;
                            border-radius: 15px;
                            display: inline-block;
                        }
                        .qr-code-container img {
                            width: 400px;
                            height: 400px;
                            border: 5px solid #fff;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                        }
                        .timer {
                            font-size: 2rem;
                            margin: 20px 0;
                            font-weight: bold;
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                        }
                        .instructions {
                            margin-top: 30px;
                            font-size: 1.2rem;
                            max-width: 600px;
                        }
                        .instructions ol {
                            text-align: left;
                            display: inline-block;
                        }
                        .qr-id {
                            background: rgba(255,255,255,0.2);
                            padding: 10px 20px;
                            border-radius: 10px;
                            margin-top: 20px;
                            font-family: monospace;
                        }
                    </style>
                    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"><\/script>
                </head>
                <body>
                    <div class="qr-display-container">
                        <div class="class-info">
                            <h1>${qrData.unitName}</h1>
                            <h2>${qrData.unitCode} - ${qrData.classType}</h2>
                            <p>Lecturer: ${qrData.lecturerName}</p>
                            <p>Topic: ${qrData.topic || 'General Session'}</p>
                        </div>
                        
                        <div class="timer" id="timer">
                            Valid for: <span id="countdown">${qrData.duration}:00</span>
                        </div>
                        
                        <div class="qr-code-container" id="qrcode"></div>
                        
                        <div class="qr-id">
                            QR ID: ${qrData.qrCodeId}
                        </div>
                        
                        <div class="instructions">
                            <h3>ðŸ“± Instructions for Students:</h3>
                            <ol>
                                <li>Open IN Attendance App</li>
                                <li>Go to "Scan QR Code"</li>
                                <li>Point camera at this QR code</li>
                                <li>Hold steady until scan is successful</li>
                                <li>Attendance will be automatically recorded</li>
                            </ol>
                        </div>
                    </div>
                    
                    <script>
                        // Generate QR code
                        const qrcode = new QRCode(document.getElementById("qrcode"), {
                            text: '${JSON.stringify(qrData).replace(/'/g, "\\'")}',
                            width: 400,
                            height: 400,
                            colorDark: "#000000",
                            colorLight: "#FFFFFF",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        // Countdown timer
                        let totalSeconds = ${qrData.duration} * 60;
                        const countdownElement = document.getElementById('countdown');
                        
                        function updateTimer() {
                            if (totalSeconds <= 0) {
                                countdownElement.innerHTML = "EXPIRED";
                                countdownElement.style.color = "#ff6b6b";
                                return;
                            }
                            
                            const minutes = Math.floor(totalSeconds / 60);
                            const seconds = totalSeconds % 60;
                            
                            countdownElement.innerHTML = 
                                minutes.toString().padStart(2, '0') + ':' + 
                                seconds.toString().padStart(2, '0');
                            
                            totalSeconds--;
                            
                            // Color change warning
                            if (totalSeconds < 300) {
                                countdownElement.style.color = "#ffa500";
                            }
                            if (totalSeconds < 60) {
                                countdownElement.style.color = "#ff6b6b";
                            }
                        }
                        
                        // Update timer every second
                        setInterval(updateTimer, 1000);
                        updateTimer();
                        
                        // Auto-refresh QR code every 30 seconds
                        setInterval(() => {
                            document.location.reload();
                        }, 30000);
                    <\/script>
                </body>
                </html>
            `;
            
            displayWindow.document.write(displayHTML);
            displayWindow.document.close();
        };

        window.copyQRData = function() {
            const qrData = {
                qrCodeId: document.getElementById('qrCodeId').textContent,
                unitName: document.getElementById('qrUnitName').textContent,
                unitCode: document.getElementById('qrUnitCode').textContent,
                classType: document.getElementById('qrClassType').textContent,
                topic: document.getElementById('qrTopic').textContent,
                lecturerName: document.getElementById('qrLecturer').textContent,
                duration: parseInt(document.getElementById('qrDuration').textContent),
                createdAt: document.getElementById('qrGenerated').textContent,
                expiresAt: document.getElementById('qrExpires').textContent
            };
            
            const qrDataString = JSON.stringify(qrData, null, 2);
            
            navigator.clipboard.writeText(qrDataString)
                .then(() => {
                    // Show notification
                    const notification = document.createElement('div');
                    notification.className = 'notification success';
                    notification.innerHTML = '<i class="fas fa-check-circle"></i> QR data copied to clipboard!';
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 3000);
                })
                .catch(() => {
                    const notification = document.createElement('div');
                    notification.className = 'notification error';
                    notification.innerHTML = '<i class="fas fa-exclamation-circle"></i> Failed to copy data';
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 3000);
                });
        };

        window.shareQRCode = async function() {
            const qrImage = document.getElementById('generatedQRImage');
            if (qrImage && qrImage.src) {
                try {
                    if (navigator.share) {
                        await navigator.share({
                            title: 'Attendance QR Code',
                            text: 'Scan this QR code for ${document.getElementById('qrUnitName').textContent}',
                            url: qrImage.src
                        });
                    } else {
                        // Fallback: copy image to clipboard
                        const canvas = document.querySelector("#qrcode canvas");
                        if (canvas) {
                            canvas.toBlob(blob => {
                                const item = new ClipboardItem({ 'image/png': blob });
                                navigator.clipboard.write([item])
                                    .then(() => {
                                        const notification = document.createElement('div');
                                        notification.className = 'notification success';
                                        notification.innerHTML = '<i class="fas fa-check-circle"></i> QR code copied to clipboard!';
                                        document.body.appendChild(notification);
                                        setTimeout(() => notification.remove(), 3000);
                                    })
                                    .catch(() => {
                                        const notification = document.createElement('div');
                                        notification.className = 'notification error';
                                        notification.innerHTML = '<i class="fas fa-exclamation-circle"></i> Failed to copy QR code';
                                        document.body.appendChild(notification);
                                        setTimeout(() => notification.remove(), 3000);
                                    });
                            });
                        }
                    }
                } catch (error) {
                    console.error('Share failed:', error);
                    const notification = document.createElement('div');
                    notification.className = 'notification info';
                    notification.innerHTML = '<i class="fas fa-info-circle"></i> Sharing not supported';
                    document.body.appendChild(notification);
                    setTimeout(() => notification.remove(), 3000);
                }
            }
        };

        // Sidebar functionality
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebarClose = document.getElementById('sidebarClose');
            const sidebar = document.getElementById('sidebar');
            
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }
            
            if (sidebarClose) {
                sidebarClose.addEventListener('click', function() {
                    sidebar.classList.remove('active');
                });
            }
        });

        // Logout function
        window.logout = function() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        };
    </script>
</body>
</html>
